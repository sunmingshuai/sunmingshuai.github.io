<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="分享高质量Tomcat Spring SpringMCV Kafka 高并发相关技术博客"><meta name="keywords" content="Tomcat Spring AMQ Kafka Zookeeper"><title>注解工作原理源码解析 | The Fourty Thieves</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">注解工作原理源码解析</h1><a id="logo" href="/.">The Fourty Thieves</a><p class="description">可能有点冒失 但我还是觉得当初应该亲自跟她要个电话</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">注解工作原理源码解析</h1><div class="post-meta"><span class="date">May 14, 2017</span><span class="category"><a href="/categories/Spring源码分析/">Spring源码分析</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i> Hits</i></i></span><a href="/2017/05/14/注解工作原理源码解析/#comments" class="comment-count"><i class="cloud-tie-join-count"><i class="join-count">0</i></i> 留言</a></div><div class="post-content"><p><code>spring</code>框架提供的<code>注解</code>方式的注入  大大方便了程序员的编程 但从另外一个方面来看 <code>spring</code>把功能细节隐藏的更深了 对技术有点追求的人 一定会很好奇spring注解的工作的方式 这篇博客以讲解<code>@Value``@Autowired``@Qualifier</code>注解为例来讲解注解是怎么工作的 (其他注解如<code>@Resource</code> <code>@Required</code>注解的工作原理类似)<br><a href="http://www.sunmingshuai.cn/2017/04/28/component-scan%E5%81%9A%E4%BA%86%E4%BA%9B%E4%BB%80%E4%B9%88/" target="_blank" rel="external">component-scan做了些什么:源码解读</a>这篇博客的最后有介绍到 注册了一些注解处理器<code>BPP</code>  我们再看下这个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">public static Set&lt;BeanDefinitionHolder&gt; registerAnnotationConfigProcessors(</div><div class="line">		BeanDefinitionRegistry registry, Object source) &#123;</div><div class="line"></div><div class="line">	Set&lt;BeanDefinitionHolder&gt; beanDefs = new LinkedHashSet&lt;BeanDefinitionHolder&gt;(4);</div><div class="line"></div><div class="line">	// @Configuration</div><div class="line">	if (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</div><div class="line">		RootBeanDefinition def = new RootBeanDefinition(ConfigurationClassPostProcessor.class);</div><div class="line">		def.setSource(source);</div><div class="line">		beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//@Autowired @Value</div><div class="line">	if (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</div><div class="line">		RootBeanDefinition def = new RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);</div><div class="line">		def.setSource(source);</div><div class="line">		beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//@Required</div><div class="line">	if (!registry.containsBeanDefinition(REQUIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</div><div class="line">		RootBeanDefinition def = new RootBeanDefinition(RequiredAnnotationBeanPostProcessor.class);</div><div class="line">		def.setSource(source);</div><div class="line">		beanDefs.add(registerPostProcessor(registry, def, REQUIRED_ANNOTATION_PROCESSOR_BEAN_NAME));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//@PostConsruct @Resouce 等java注解</div><div class="line">	// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.</div><div class="line">	if (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</div><div class="line">		RootBeanDefinition def = new RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);</div><div class="line">		def.setSource(source);</div><div class="line">		beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//</div><div class="line">	// Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.</div><div class="line">	if (jpaPresent &amp;&amp; !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</div><div class="line">		RootBeanDefinition def = new RootBeanDefinition();</div><div class="line">		try &#123;</div><div class="line">			def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,</div><div class="line">					AnnotationConfigUtils.class.getClassLoader()));</div><div class="line">		&#125;</div><div class="line">		catch (ClassNotFoundException ex) &#123;</div><div class="line">			throw new IllegalStateException(</div><div class="line">					&quot;Cannot load optional framework class: &quot; + PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME, ex);</div><div class="line">		&#125;</div><div class="line">		def.setSource(source);</div><div class="line">		beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return beanDefs;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注解以及对应的后置处理器如下表所示</p>
<table>
<thead>
<tr>
<th style="text-align:center">注解</th>
<th style="text-align:left">BPP</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@Configuration</td>
<td style="text-align:left">ConfigurationClassPostProcessor</td>
</tr>
<tr>
<td style="text-align:center">@Autowired(@Qualifier),@Value,@Inject</td>
<td style="text-align:left">AutowiredAnnotationBeanPostProcessor</td>
</tr>
<tr>
<td style="text-align:center">@Required</td>
<td style="text-align:left">RequiredAnnotationBeanPostProcessor</td>
</tr>
<tr>
<td style="text-align:center">@Postconstruct,PreDestroy,@Resource</td>
<td style="text-align:left">CommonAnnotationBeanPostProcessor</td>
</tr>
<tr>
<td style="text-align:center">@Persistence</td>
<td style="text-align:left">PersistenceAnnotationBeanPostProcessor</td>
</tr>
</tbody>
</table>
<p>我们看下<code>AutowiredAnnotationBeanPostProcessor</code>这个处理器 <code>@Autowired``@Qualifier``@Value</code>注解的解析就是在<code>postProcessMergedBeanDefinition</code>以及<code>postProcessPropertyValues</code>这两个方法中完成的</p>
<p><code>postProcessMergedBeanDefinition</code>这个方法执行时间的节点是在创建<code>bean</code>的实例后 在<code>populateBean()</code>方法调用前调用的<br>这个方法主要完成的功能就是找出带有特定注解的<code>field</code> <code>method</code> 并记录在数据结构中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// 执行的时间节点是bean刚刚初始化完 但在属性填充之前</div><div class="line">public void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, Class&lt;?&gt; beanType, String beanName) &#123;</div><div class="line">	if (beanType != null) &#123;</div><div class="line">		//找出所有的字段或者方法上的@Autowired @Value @Inject注解 并保存</div><div class="line">		InjectionMetadata metadata = findAutowiringMetadata(beanName, beanType, null);</div><div class="line">		//加入到BeanDefinition</div><div class="line">		metadata.checkConfigMembers(beanDefinition);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后会调用<code>buildAutowiringMetadata(clazz)</code>完成检查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 分别对field method做检查 是否存在相应注解</div><div class="line"> *</div><div class="line"> * @param clazz</div><div class="line"> * @return</div><div class="line"> */</div><div class="line">private InjectionMetadata buildAutowiringMetadata(Class&lt;?&gt; clazz) &#123;</div><div class="line">	LinkedList&lt;InjectionMetadata.InjectedElement&gt; elements = new LinkedList&lt;InjectionMetadata.InjectedElement&gt;();</div><div class="line">	Class&lt;?&gt; targetClass = clazz;</div><div class="line"></div><div class="line">	do &#123;</div><div class="line">		LinkedList&lt;InjectionMetadata.InjectedElement&gt; currElements = new LinkedList&lt;InjectionMetadata.InjectedElement&gt;();</div><div class="line">		// 循环所有的field</div><div class="line">		for (Field field : targetClass.getDeclaredFields()) &#123;</div><div class="line">			// 寻找@Autowired @Value @Inject注解 只处理一个</div><div class="line">			Annotation ann = findAutowiredAnnotation(field);</div><div class="line">			if (ann != null) &#123;</div><div class="line">				//忽略静态属性的注入</div><div class="line">				if (Modifier.isStatic(field.getModifiers())) &#123;</div><div class="line">					if (logger.isWarnEnabled()) &#123;</div><div class="line">						logger.warn(&quot;Autowired annotation is not supported on static fields: &quot; + field);</div><div class="line">					&#125;</div><div class="line">					continue;</div><div class="line">				&#125;</div><div class="line">				boolean required = determineRequiredStatus(ann);</div><div class="line">				currElements.add(new AutowiredFieldElement(field, required));</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		// 循环所有的方法 比如setxxx方法注入</div><div class="line">		for (Method method : targetClass.getDeclaredMethods()) &#123;</div><div class="line">			Annotation ann = null;</div><div class="line">			Method bridgedMethod = BridgeMethodResolver.findBridgedMethod(method);</div><div class="line">			if (BridgeMethodResolver.isVisibilityBridgeMethodPair(method, bridgedMethod)) &#123;</div><div class="line">				ann = findAutowiredAnnotation(bridgedMethod);</div><div class="line">			&#125;</div><div class="line">			if (ann != null &amp;&amp; method.equals(ClassUtils.getMostSpecificMethod(method, clazz))) &#123;</div><div class="line">				if (Modifier.isStatic(method.getModifiers())) &#123;</div><div class="line">					if (logger.isWarnEnabled()) &#123;</div><div class="line">						logger.warn(&quot;Autowired annotation is not supported on static methods: &quot; + method);</div><div class="line">					&#125;</div><div class="line">					continue;</div><div class="line">				&#125;</div><div class="line">				if (method.getParameterTypes().length == 0) &#123;</div><div class="line">					if (logger.isWarnEnabled()) &#123;</div><div class="line">						logger.warn(&quot;Autowired annotation should be used on methods with actual parameters: &quot; + method);</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				boolean required = determineRequiredStatus(ann);</div><div class="line">				PropertyDescriptor pd = BeanUtils.findPropertyForMethod(bridgedMethod, clazz);</div><div class="line">				currElements.add(new AutowiredMethodElement(method, required, pd));</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		elements.addAll(0, currElements);</div><div class="line">		targetClass = targetClass.getSuperclass();</div><div class="line">	&#125;</div><div class="line">	while (targetClass != null &amp;&amp; targetClass != Object.class);</div><div class="line"></div><div class="line">	return new InjectionMetadata(clazz, elements);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>特定注解指的就是<code>@Autowired</code> <code>@Value</code> <code>@Inject(较少用)</code> <code>@Qualifier</code>注解是跟<code>@Autowired</code>注解搭配使用的 单独使用是不起作用的<br>特定的数据结构指的就是InjectionMetadata 博主前面说过 阅读源代码千万不要对这样的代码感到畏惧 就把他当成一个包装类或者工具类就可以了 为了完成或者包装某些功能写出的一些类而已<br>再具体的代码就不带着一起看了 相信读者阅读这样的代码应该没有任何问题<br>我们接着看下另外一个方法<code>postProcessPropertyValues(xxx)</code><br>这个方法的执行的时间节点是在<code>populateBean(xxx)</code>之后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public PropertyValues postProcessPropertyValues(</div><div class="line">		PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName) throws BeansException &#123;</div><div class="line"></div><div class="line">	//从缓存中读取出</div><div class="line">	InjectionMetadata metadata = findAutowiringMetadata(beanName, bean.getClass(), pvs);</div><div class="line">	try &#123;</div><div class="line">		//注入</div><div class="line">		metadata.inject(bean, beanName, pvs);</div><div class="line">	&#125;</div><div class="line">	catch (Throwable ex) &#123;</div><div class="line">		throw new BeanCreationException(beanName, &quot;Injection of autowired dependencies failed&quot;, ex);</div><div class="line">	&#125;</div><div class="line">	return pvs;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在<code>postProcessMergedBeanDefinition(xxx)</code>方法中把循环检查出的特定注解修饰的<code>field``method</code>以特定的数据结构以<code>beanName</code>为key保存在了一个map中 在<code>postProcessPropertyValues(xxx)</code>方法中取出来处理<br>这里我们以<code>field</code>注入讲解 进入方法<code>AutowiredFieldElement#inject(xxx)</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void inject(Object bean, String beanName, PropertyValues pvs) throws Throwable &#123;</div><div class="line">	Field field = (Field) this.member;</div><div class="line">	try &#123;</div><div class="line">		Object value;</div><div class="line">		if (this.cached) &#123;</div><div class="line">			value = resolvedCachedArgument(beanName, this.cachedFieldValue);</div><div class="line">		&#125;</div><div class="line">		else &#123;</div><div class="line">			DependencyDescriptor desc = new DependencyDescriptor(field, this.required);</div><div class="line">			Set&lt;String&gt; autowiredBeanNames = new LinkedHashSet&lt;String&gt;(1);</div><div class="line">			TypeConverter typeConverter = beanFactory.getTypeConverter();</div><div class="line">			value = beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter);</div><div class="line">			synchronized (this) &#123;</div><div class="line">				if (!this.cached) &#123;</div><div class="line">					if (value != null || this.required) &#123;</div><div class="line">						this.cachedFieldValue = desc;</div><div class="line">						registerDependentBeans(beanName, autowiredBeanNames);</div><div class="line">						if (autowiredBeanNames.size() == 1) &#123;</div><div class="line">							String autowiredBeanName = autowiredBeanNames.iterator().next();</div><div class="line">							if (beanFactory.containsBean(autowiredBeanName)) &#123;</div><div class="line">								if (beanFactory.isTypeMatch(autowiredBeanName, field.getType())) &#123;</div><div class="line">									this.cachedFieldValue = new RuntimeBeanReference(autowiredBeanName);</div><div class="line">								&#125;</div><div class="line">							&#125;</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">					else &#123;</div><div class="line">						this.cachedFieldValue = null;</div><div class="line">					&#125;</div><div class="line">					this.cached = true;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		// 通过反射设置值</div><div class="line">		if (value != null) &#123;</div><div class="line">			ReflectionUtils.makeAccessible(field);</div><div class="line">			field.set(bean, value);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	catch (Throwable ex) &#123;</div><div class="line">		throw new BeanCreationException(&quot;Could not autowire field: &quot; + field, ex);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里 <code>DependencyDescriptor</code>同样是为了方便操作 对<code>field</code>进行的包装<br><code>beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter)</code>方法完成解析  最后会调用<code>doResolveDependency(xxx)</code>方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line">protected Object doResolveDependency(DependencyDescriptor descriptor, Class&lt;?&gt; type, String beanName,</div><div class="line">		Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter) throws BeansException &#123;</div><div class="line">	//处理@Value注解</div><div class="line">	Object value = getAutowireCandidateResolver().getSuggestedValue(descriptor);</div><div class="line">	if (value != null) &#123;</div><div class="line">		if (value instanceof String) &#123;</div><div class="line">			// 这里会处理掉&quot;$&#123;&#125;&quot;</div><div class="line">			String strVal = resolveEmbeddedValue((String) value);</div><div class="line">			BeanDefinition bd = (beanName != null &amp;&amp; containsBean(beanName) ? getMergedBeanDefinition(beanName) : null);</div><div class="line">			value = evaluateBeanDefinitionString(strVal, bd);</div><div class="line">		&#125;</div><div class="line">		TypeConverter converter = (typeConverter != null ? typeConverter : getTypeConverter());</div><div class="line">		return (descriptor.getField() != null ?</div><div class="line">				converter.convertIfNecessary(value, type, descriptor.getField()) :</div><div class="line">				converter.convertIfNecessary(value, type, descriptor.getMethodParameter()));</div><div class="line">	&#125;</div><div class="line">	//处理@Autowired注解</div><div class="line">	if (type.isArray()) &#123;</div><div class="line">		Class&lt;?&gt; componentType = type.getComponentType();</div><div class="line">		Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, componentType, descriptor);</div><div class="line">		if (matchingBeans.isEmpty()) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				raiseNoSuchBeanDefinitionException(componentType, &quot;array of &quot; + componentType.getName(), descriptor);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		if (autowiredBeanNames != null) &#123;</div><div class="line">			autowiredBeanNames.addAll(matchingBeans.keySet());</div><div class="line">		&#125;</div><div class="line">		TypeConverter converter = (typeConverter != null ? typeConverter : getTypeConverter());</div><div class="line">		return converter.convertIfNecessary(matchingBeans.values(), type);</div><div class="line">	&#125;</div><div class="line">	else if (Collection.class.isAssignableFrom(type) &amp;&amp; type.isInterface()) &#123;</div><div class="line">		Class&lt;?&gt; elementType = descriptor.getCollectionType();</div><div class="line">		if (elementType == null) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				throw new FatalBeanException(&quot;No element type declared for collection [&quot; + type.getName() + &quot;]&quot;);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, elementType, descriptor);</div><div class="line">		if (matchingBeans.isEmpty()) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				raiseNoSuchBeanDefinitionException(elementType, &quot;collection of &quot; + elementType.getName(), descriptor);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		if (autowiredBeanNames != null) &#123;</div><div class="line">			autowiredBeanNames.addAll(matchingBeans.keySet());</div><div class="line">		&#125;</div><div class="line">		TypeConverter converter = (typeConverter != null ? typeConverter : getTypeConverter());</div><div class="line">		return converter.convertIfNecessary(matchingBeans.values(), type);</div><div class="line">	&#125;</div><div class="line">	else if (Map.class.isAssignableFrom(type) &amp;&amp; type.isInterface()) &#123;</div><div class="line">		Class&lt;?&gt; keyType = descriptor.getMapKeyType();</div><div class="line">		if (keyType == null || !String.class.isAssignableFrom(keyType)) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				throw new FatalBeanException(&quot;Key type [&quot; + keyType + &quot;] of map [&quot; + type.getName() +</div><div class="line">						&quot;] must be assignable to [java.lang.String]&quot;);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		Class&lt;?&gt; valueType = descriptor.getMapValueType();</div><div class="line">		if (valueType == null) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				throw new FatalBeanException(&quot;No value type declared for map [&quot; + type.getName() + &quot;]&quot;);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, valueType, descriptor);</div><div class="line">		if (matchingBeans.isEmpty()) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				raiseNoSuchBeanDefinitionException(valueType, &quot;map with value type &quot; + valueType.getName(), descriptor);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		if (autowiredBeanNames != null) &#123;</div><div class="line">			autowiredBeanNames.addAll(matchingBeans.keySet());</div><div class="line">		&#125;</div><div class="line">		return matchingBeans;</div><div class="line">	&#125;</div><div class="line">	else &#123;</div><div class="line">		Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, type, descriptor);</div><div class="line">		if (matchingBeans.isEmpty()) &#123;</div><div class="line">			if (descriptor.isRequired()) &#123;</div><div class="line">				raiseNoSuchBeanDefinitionException(type, &quot;&quot;, descriptor);</div><div class="line">			&#125;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		if (matchingBeans.size() &gt; 1) &#123;</div><div class="line">			String primaryBeanName = determinePrimaryCandidate(matchingBeans, descriptor);</div><div class="line">			if (primaryBeanName == null) &#123;</div><div class="line">				throw new NoUniqueBeanDefinitionException(type, matchingBeans.keySet());</div><div class="line">			&#125;</div><div class="line">			if (autowiredBeanNames != null) &#123;</div><div class="line">				autowiredBeanNames.add(primaryBeanName);</div><div class="line">			&#125;</div><div class="line">			return matchingBeans.get(primaryBeanName);</div><div class="line">		&#125;</div><div class="line">		// We have exactly one match.</div><div class="line">		Map.Entry&lt;String, Object&gt; entry = matchingBeans.entrySet().iterator().next();</div><div class="line">		if (autowiredBeanNames != null) &#123;</div><div class="line">			autowiredBeanNames.add(entry.getKey());</div><div class="line">		&#125;</div><div class="line">		return entry.getValue();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们先看对<code>@Value</code>注解的解析<br><code>@Value</code>注解有两种使用方法 除了可以直接指出我们想要的值外 还可以<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@Value(&quot;$&#123;xxx&#125;&quot;)</div></pre></td></tr></table></figure></p>
<blockquote>
<p>这个功能在<code>spring3.x</code>以后才能使用 3.x以前的版本取出来的就是<code>${xxx}</code>而不会再被解析 其背后的原因就是3.x以后的代码 通过PropertyPlaceholderConfigurer向<code>beanFactory</code>加入了一个处理器 <a href="http://www.sunmingshuai.cn/2017/05/13/PropertyPlaceholderConfigurer%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="external">PropertyPlaceholderConfigurer源码解析</a> 这篇文章的最后又指出</p>
</blockquote>
<p><code>getAutowireCandidateResolver()</code>这个方法返回的是在初始化<code>beanFactory</code>的过程中加入的<code>QualifierAnnotationAutowireCandidateResolver</code>类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">protected void customizeBeanFactory(DefaultListableBeanFactory beanFactory) &#123;</div><div class="line">	if (this.allowBeanDefinitionOverriding != null) &#123;</div><div class="line">		beanFactory.setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding);</div><div class="line">	&#125;</div><div class="line">	if (this.allowCircularReferences != null) &#123;</div><div class="line">		beanFactory.setAllowCircularReferences(this.allowCircularReferences);</div><div class="line">	&#125;</div><div class="line">	//设置Qualifier注解解析类</div><div class="line">	beanFactory.setAutowireCandidateResolver(new QualifierAnnotationAutowireCandidateResolver());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>QualifierAnnotationAutowireCandidateResolver#getSuggestedValue(xxx)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public Object getSuggestedValue(DependencyDescriptor descriptor) &#123;</div><div class="line">	Object value = findValue(descriptor.getAnnotations());</div><div class="line">	if (value == null) &#123;</div><div class="line">		MethodParameter methodParam = descriptor.getMethodParameter();</div><div class="line">		if (methodParam != null) &#123;</div><div class="line">			value = findValue(methodParam.getMethodAnnotations());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return value;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果有<code>@Value</code>注解的话 返回设置的<code>value</code>值 如果没有就返回<code>null</code><br>如果返回的<code>value</code>不为null的话 就需要进一步处理这个原始值 因为这个值可能不是我们最终想要的 例如我们前面讲到的<code>@Value(&quot;${xxx}&quot;)</code> 这个时候返回的就是<code>${xxx}</code> 显然不是我们想要的 当然spring还提供了处理表达式的支持 这里不再讲解<br>最后再通过converter处理一遍返回</p>
<p>如果返回的是null 说明没有<code>@Value</code>注解 <code>spring</code>增加了对<code>array</code> <code>collection</code> <code>map</code>注入的支持 有兴趣的可以看看 我们就选一个最简单最基础的注入为例来讲解 <code>@Autowired</code>的工作原理 也就是最后一个<code>else</code>分支<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">			Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, type, descriptor);</div><div class="line">			if (matchingBeans.isEmpty()) &#123;</div><div class="line">				if (descriptor.isRequired()) &#123;</div><div class="line">					raiseNoSuchBeanDefinitionException(type, &quot;&quot;, descriptor);</div><div class="line">				&#125;</div><div class="line">				return null;</div><div class="line">			&#125;</div><div class="line">			if (matchingBeans.size() &gt; 1) &#123;</div><div class="line">				String primaryBeanName = determinePrimaryCandidate(matchingBeans, descriptor);</div><div class="line">				if (primaryBeanName == null) &#123;</div><div class="line">					throw new NoUniqueBeanDefinitionException(type, matchingBeans.keySet());</div><div class="line">				&#125;</div><div class="line">				if (autowiredBeanNames != null) &#123;</div><div class="line">					autowiredBeanNames.add(primaryBeanName);</div><div class="line">				&#125;</div><div class="line">				return matchingBeans.get(primaryBeanName);</div><div class="line">			&#125;</div><div class="line">			// We have exactly one match.</div><div class="line">			Map.Entry&lt;String, Object&gt; entry = matchingBeans.entrySet().iterator().next();</div><div class="line">			if (autowiredBeanNames != null) &#123;</div><div class="line">				autowiredBeanNames.add(entry.getKey());</div><div class="line">			&#125;</div><div class="line">			return entry.getValue();</div><div class="line">		&#125;</div></pre></td></tr></table></figure></p>
<p>进入<code>findAutowireCandidates(xxx)</code>方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">protected Map&lt;String, Object&gt; findAutowireCandidates(</div><div class="line">		String beanName, Class&lt;?&gt; requiredType, DependencyDescriptor descriptor) &#123;</div><div class="line"></div><div class="line">	String[] candidateNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(</div><div class="line">			this, requiredType, true, descriptor.isEager());</div><div class="line">	Map&lt;String, Object&gt; result = new LinkedHashMap&lt;String, Object&gt;(candidateNames.length);</div><div class="line">	for (Class&lt;?&gt; autowiringType : this.resolvableDependencies.keySet()) &#123;</div><div class="line">		if (autowiringType.isAssignableFrom(requiredType)) &#123;</div><div class="line">			Object autowiringValue = this.resolvableDependencies.get(autowiringType);</div><div class="line">			autowiringValue = AutowireUtils.resolveAutowiringValue(autowiringValue, requiredType);</div><div class="line">			if (requiredType.isInstance(autowiringValue)) &#123;</div><div class="line">				result.put(ObjectUtils.identityToString(autowiringValue), autowiringValue);</div><div class="line">				break;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	for (String candidateName : candidateNames) &#123;</div><div class="line">		if (!candidateName.equals(beanName) &amp;&amp; isAutowireCandidate(candidateName, descriptor)) &#123;</div><div class="line">			result.put(candidateName, getBean(candidateName));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>首先从<code>beanFactory</code>中取出所有符合<code>requiredType</code>类型的<code>bean</code>的名称 <code>requiredType</code>是要被注入的字段的类型(其实这一步就已经完成了@Autowired注解的功能) 然后循环判断这些<code>bean</code>中有哪些是符合条件的 哪些是不符合条件的(想一想为什么还要继续判断?)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public boolean isAutowireCandidate(String beanName, DependencyDescriptor descriptor)</div><div class="line">		throws NoSuchBeanDefinitionException &#123;</div><div class="line"></div><div class="line">	// Consider FactoryBeans as autowiring candidates.</div><div class="line">	boolean isFactoryBean = (descriptor != null &amp;&amp; descriptor.getDependencyType() != null &amp;&amp;</div><div class="line">			FactoryBean.class.isAssignableFrom(descriptor.getDependencyType()));</div><div class="line">	if (isFactoryBean) &#123;</div><div class="line">		beanName = BeanFactoryUtils.transformedBeanName(beanName);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if (containsBeanDefinition(beanName)) &#123;</div><div class="line">		return isAutowireCandidate(beanName, getMergedLocalBeanDefinition(beanName), descriptor);</div><div class="line">	&#125;</div><div class="line">	else if (containsSingleton(beanName)) &#123;</div><div class="line">		return isAutowireCandidate(beanName, new RootBeanDefinition(getType(beanName)), descriptor);</div><div class="line">	&#125;</div><div class="line">	else if (getParentBeanFactory() instanceof ConfigurableListableBeanFactory) &#123;</div><div class="line">		// No bean definition found in this factory -&gt; delegate to parent.</div><div class="line">		return ((ConfigurableListableBeanFactory) getParentBeanFactory()).isAutowireCandidate(beanName, descriptor);</div><div class="line">	&#125;</div><div class="line">	else &#123;</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个方法里面是考虑是很多中情况了 比如是不是<code>factoryBean</code>等 这里我们还是以最简单的情况分析<br>最后会进入方法<code>QualifierAnnotationAutowireCandidateResolver#isAutowireCandidate(xxx)</code>方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public boolean isAutowireCandidate(BeanDefinitionHolder bdHolder, DependencyDescriptor descriptor) &#123;</div><div class="line">	if (!bdHolder.getBeanDefinition().isAutowireCandidate()) &#123;</div><div class="line">		// 如果已经设置了非候选类 直接返回</div><div class="line">		return false;</div><div class="line">	&#125;</div><div class="line">	if (descriptor == null) &#123;</div><div class="line">		// no qualification necessary</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line">	boolean match = checkQualifiers(bdHolder, descriptor.getAnnotations());</div><div class="line">	if (match) &#123;</div><div class="line">		MethodParameter methodParam = descriptor.getMethodParameter();</div><div class="line">		if (methodParam != null) &#123;</div><div class="line">			Method method = methodParam.getMethod();</div><div class="line">			if (method == null || void.class.equals(method.getReturnType())) &#123;</div><div class="line">				match = checkQualifiers(bdHolder, methodParam.getMethodAnnotations());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return match;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对于<code>@Autowired</code>注解 是按类型匹配的  前面已经筛选出了<code>beanFactory</code>中所有的符合条件的类型 这里为什么还要继续筛选呢  原因就是可能还会有<code>@Qualifier</code>注解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">protected boolean checkQualifiers(BeanDefinitionHolder bdHolder, Annotation[] annotationsToSearch) &#123;</div><div class="line">	if (ObjectUtils.isEmpty(annotationsToSearch)) &#123;</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line">	SimpleTypeConverter typeConverter = new SimpleTypeConverter();</div><div class="line">	for (Annotation annotation : annotationsToSearch) &#123;</div><div class="line">		Class&lt;? extends Annotation&gt; type = annotation.annotationType();</div><div class="line">		boolean checkMeta = true;</div><div class="line">		boolean fallbackToMeta = false;</div><div class="line">		if (isQualifier(type)) &#123;</div><div class="line">			if (!checkQualifier(bdHolder, annotation, typeConverter)) &#123;</div><div class="line">				fallbackToMeta = true;</div><div class="line">			&#125;</div><div class="line">			else &#123;</div><div class="line">				checkMeta = false;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		if (checkMeta) &#123;</div><div class="line">			boolean foundMeta = false;</div><div class="line">			for (Annotation metaAnn : type.getAnnotations()) &#123;</div><div class="line">				Class&lt;? extends Annotation&gt; metaType = metaAnn.annotationType();</div><div class="line">				if (isQualifier(metaType)) &#123;</div><div class="line">					foundMeta = true;</div><div class="line">					// Only accept fallback match if @Qualifier annotation has a value...</div><div class="line">					// Otherwise it is just a marker for a custom qualifier annotation.</div><div class="line">					if ((fallbackToMeta &amp;&amp; StringUtils.isEmpty(AnnotationUtils.getValue(metaAnn))) ||</div><div class="line">							!checkQualifier(bdHolder, metaAnn, typeConverter)) &#123;</div><div class="line">						return false;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			if (fallbackToMeta &amp;&amp; !foundMeta) &#123;</div><div class="line">				return false;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个方法做的工作就是检查有没有<code>@Qualifier</code>注解 如果有的话 再检查是不是符合条件<br>例如虽然有多个候选的符合条件的类型 但是<code>@Qualifier</code>指出了特定的名称 这样就实现了按照名称的匹配<br>最后返回通过最终筛选的bean</p>
</div><div class="tags"></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2017/05/13/LimitLatch源码解析/" class="pre">LimitLatch源码解析</a><a href="/2017/05/20/aop基本概念/" class="next">aop基本概念</a></div><div id="comments"><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java并发包/">Java并发包</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Raspberry-Pi/">Raspberry Pi</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring源码分析/">Spring源码分析</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat源码分析/">Tomcat源码分析</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/书单/">书单</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/">杂七杂八</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/concurrent/" style="font-size: 15px;">concurrent</a> <a href="/tags/context/" style="font-size: 15px;">context</a> <a href="/tags/aop/" style="font-size: 15px;">aop</a> <a href="/tags/BFPP/" style="font-size: 15px;">BFPP</a> <a href="/tags/jdk动态代理/" style="font-size: 15px;">jdk动态代理</a> <a href="/tags/component-scan/" style="font-size: 15px;">component-scan</a> <a href="/tags/父子容器/" style="font-size: 15px;">父子容器</a> <a href="/tags/兴趣爱好/" style="font-size: 15px;">兴趣爱好</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/31/Spring问题快问快答/">Spring问题快问快答</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/07/AbstractQueuedSynchronizer-队列同步器-实现分析/">AbstractQueuedSynchronizer(队列同步器)实现分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/aop源码解析辅助-jdk动态代理/">aop源码解析辅助:jdk动态代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/aop源码解析四-代理方法的调用/">aop源码解析四:代理方法的调用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/20/树莓派安装Ubuntu-server/">树莓派安装Ubuntu server</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/15/为什么要读书/">为什么要读书</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/spring父子容器源码解析二/">spring父子容器源码解析二</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/spring父子容器源码解析一/">spring父子容器源码解析一</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/aop源码解析三-postProcessAfterInitialization/">aop源码解析三:postProcessAfterInitialization</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/aop源码解析二-postProcessBeforeInstantiation/">aop源码解析二:postProcessBeforeInstantiation</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">孙明帅.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.0"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.0" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>var cloudTieConfig = {
  url: document.location.href, 
  sourceId: "",
  productKey: '7e92867159a646e798100b8a60c85579## 网易云跟帖(productKey)',
  target: "cloud-tie-wrapper"
};</script><script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script></body></html>