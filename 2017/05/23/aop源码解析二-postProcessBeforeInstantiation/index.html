<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="分享高质量Tomcat Spring SpringMCV Kafka 高并发相关技术博客"><meta name="keywords" content="Tomcat Spring AMQ Kafka Zookeeper"><title>aop源码解析二:postProcessBeforeInstantiation | The Fourty Thieves</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">aop源码解析二:postProcessBeforeInstantiation</h1><a id="logo" href="/.">The Fourty Thieves</a><p class="description">可能有点冒失 但我还是觉得当初应该亲自跟她要个电话</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">aop源码解析二:postProcessBeforeInstantiation</h1><div class="post-meta"><span class="date">May 23, 2017</span><span class="category"><a href="/categories/Spring源码分析/">Spring源码分析</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i> Hits</i></i></span><a href="/2017/05/23/aop源码解析二-postProcessBeforeInstantiation/#comments" class="comment-count"><i class="cloud-tie-join-count"><i class="join-count">0</i></i> 留言</a></div><div class="post-content"><p>我们就不再从<code>bean</code>的加载过程开始看了 在<a href="http://www.sunmingshuai.cn/2017/05/22/aop%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80/" target="_blank" rel="external">aop源码解析一:注册BPP</a>中 介绍到了一个后置处理器 <code>AnnotationAwareAspectJAutoProxyCreator</code> 我们就从这个类入手<code>aop</code><br>先看<code>postProcessBeforeInstantiation</code> 很显然 是bean实例化前调用的 里面好像是处理了一些事情<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</div><div class="line">	Object cacheKey = getCacheKey(beanClass, beanName);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (beanName == <span class="keyword">null</span> || !<span class="keyword">this</span>.targetSourcedBeans.containsKey(beanName)) &#123;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.advisedBeans.containsKey(cacheKey)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//这里需要注意的是 shouldSkip方法被子类覆盖了 这个很容易忽略</span></div><div class="line">		<span class="keyword">if</span> (isInfrastructureClass(beanClass) || shouldSkip(beanClass, beanName)) &#123;</div><div class="line">			<span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Create proxy here if we have a custom TargetSource.</span></div><div class="line">	<span class="comment">// Suppresses unnecessary default instantiation of the target bean:</span></div><div class="line">	<span class="comment">// The TargetSource will handle target instances in a custom fashion.</span></div><div class="line">	<span class="keyword">if</span> (beanName != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="comment">//todo 这里返回null!!!</span></div><div class="line">		TargetSource targetSource = getCustomTargetSource(beanClass, beanName);</div><div class="line">		<span class="keyword">if</span> (targetSource != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">this</span>.targetSourcedBeans.put(beanName, Boolean.TRUE);</div><div class="line">			Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(beanClass, beanName, targetSource);</div><div class="line">			Object proxy = createProxy(beanClass, beanName, specificInterceptors, targetSource);</div><div class="line">			<span class="keyword">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</div><div class="line">			<span class="keyword">return</span> proxy;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里<code>shouldSkip(beanClass, beanName)</code>方法是一个很容易忽略的方法 可能是方法名字的原因或者复杂的继承关系吧 但在这个方法的实现过程中 已经把所有的切面加载完成了<br><code>AspectJAwareAdvisorAutoProxyCreator##shouldSkip</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">shouldSkip</span><span class="params">(Class beanClass, String beanName)</span> </span>&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Consider optimization by caching the list of the aspect names</span></div><div class="line">	List&lt;Advisor&gt; candidateAdvisors = findCandidateAdvisors();</div><div class="line">	<span class="keyword">for</span> (Advisor advisor : candidateAdvisors) &#123;</div><div class="line">		<span class="keyword">if</span> (advisor <span class="keyword">instanceof</span> AspectJPointcutAdvisor) &#123;</div><div class="line">			<span class="keyword">if</span> (((AbstractAspectJAdvice) advisor.getAdvice()).getAspectName().equals(beanName)) &#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">super</span>.shouldSkip(beanClass, beanName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>首先找出所有的<code>advisor</code> 如果要加载的这个<code>bean</code>是一个<code>advisor</code>的话 当然就不会代理了<br><code>AnnotationAwareAspectJAutoProxyCreator##findCandidateAdvisors()</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> List&lt;Advisor&gt; <span class="title">findCandidateAdvisors</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">// Add all the Spring advisors found according to superclass rules.</span></div><div class="line">	<span class="comment">// 寻找bean的类型为Aspect.class的 我们更关心注解的形式 这里不过多的讲解</span></div><div class="line">	List&lt;Advisor&gt; advisors = <span class="keyword">super</span>.findCandidateAdvisors();</div><div class="line">	<span class="comment">// Build Advisors for all AspectJ aspects in the bean factory.</span></div><div class="line">	<span class="comment">// 处理注解(@Aspect)的形式</span></div><div class="line">	advisors.addAll(<span class="keyword">this</span>.aspectJAdvisorsBuilder.buildAspectJAdvisors());</div><div class="line">	<span class="keyword">return</span> advisors;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;Advisor&gt; <span class="title">buildAspectJAdvisors</span><span class="params">()</span> </span>&#123;</div><div class="line">	List&lt;String&gt; aspectNames = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">		aspectNames = <span class="keyword">this</span>.aspectBeanNames;</div><div class="line">		<span class="keyword">if</span> (aspectNames == <span class="keyword">null</span>) &#123;</div><div class="line">			List&lt;Advisor&gt; advisors = <span class="keyword">new</span> LinkedList&lt;Advisor&gt;();</div><div class="line">			aspectNames = <span class="keyword">new</span> LinkedList&lt;String&gt;();</div><div class="line">			<span class="comment">// 根据类型取出beanFactory中所有的bean 包括父容器 然后循环判断</span></div><div class="line">			<span class="comment">// todo 这样就可能造成重复加载</span></div><div class="line">			String[] beanNames =</div><div class="line">					BeanFactoryUtils.beanNamesForTypeIncludingAncestors(<span class="keyword">this</span>.beanFactory, Object.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">			<span class="keyword">for</span> (String beanName : beanNames) &#123;</div><div class="line">				<span class="comment">// 提供可供扩展的模式匹配</span></div><div class="line">				<span class="keyword">if</span> (!isEligibleBean(beanName)) &#123;</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">// We must be careful not to instantiate beans eagerly as in this</span></div><div class="line">				<span class="comment">// case they would be cached by the Spring container but would not</span></div><div class="line">				<span class="comment">// have been weaved</span></div><div class="line">				Class beanType = <span class="keyword">this</span>.beanFactory.getType(beanName);</div><div class="line">				<span class="keyword">if</span> (beanType == <span class="keyword">null</span>) &#123;</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">// 带有@Aspect 注解 并且不是由ajc编译生成 code-style方式的切面spring aop不处理(在前面已经处理过了)</span></div><div class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>.advisorFactory.isAspect(beanType)) &#123;</div><div class="line">					aspectNames.add(beanName);</div><div class="line">					<span class="comment">//包装类</span></div><div class="line">					AspectMetadata amd = <span class="keyword">new</span> AspectMetadata(beanType, beanName);</div><div class="line">					<span class="keyword">if</span> (amd.getAjType().getPerClause().getKind() == PerClauseKind.SINGLETON) &#123;</div><div class="line">						<span class="comment">//包装类</span></div><div class="line">						MetadataAwareAspectInstanceFactory factory =</div><div class="line">								<span class="keyword">new</span> BeanFactoryAspectInstanceFactory(<span class="keyword">this</span>.beanFactory, beanName);</div><div class="line">						<span class="comment">//将切面类中的所有的切面方法拆解出来</span></div><div class="line">						List&lt;Advisor&gt; classAdvisors = <span class="keyword">this</span>.advisorFactory.getAdvisors(factory);</div><div class="line">						<span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory.isSingleton(beanName)) &#123;</div><div class="line">							<span class="keyword">this</span>.advisorsCache.put(beanName, classAdvisors);</div><div class="line">						&#125;</div><div class="line">						<span class="keyword">else</span> &#123;</div><div class="line">							<span class="keyword">this</span>.aspectFactoryCache.put(beanName, factory);</div><div class="line">						&#125;</div><div class="line">						advisors.addAll(classAdvisors);</div><div class="line">					&#125;</div><div class="line">					<span class="keyword">else</span> &#123;</div><div class="line">						<span class="comment">// Per target or per this.</span></div><div class="line">						<span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory.isSingleton(beanName)) &#123;</div><div class="line">							<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Bean with name '"</span> + beanName +</div><div class="line">									<span class="string">"' is a singleton, but aspect instantiation model is not singleton"</span>);</div><div class="line">						&#125;</div><div class="line">						MetadataAwareAspectInstanceFactory factory =</div><div class="line">								<span class="keyword">new</span> PrototypeAspectInstanceFactory(<span class="keyword">this</span>.beanFactory, beanName);</div><div class="line">						<span class="keyword">this</span>.aspectFactoryCache.put(beanName, factory);</div><div class="line">						advisors.addAll(<span class="keyword">this</span>.advisorFactory.getAdvisors(factory));</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">this</span>.aspectBeanNames = aspectNames;</div><div class="line">			<span class="keyword">return</span> advisors;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (aspectNames.isEmpty()) &#123;</div><div class="line">		<span class="keyword">return</span> Collections.EMPTY_LIST;</div><div class="line">	&#125;</div><div class="line">	List&lt;Advisor&gt; advisors = <span class="keyword">new</span> LinkedList&lt;Advisor&gt;();</div><div class="line">	<span class="keyword">for</span> (String aspectName : aspectNames) &#123;</div><div class="line">		List&lt;Advisor&gt; cachedAdvisors = <span class="keyword">this</span>.advisorsCache.get(aspectName);</div><div class="line">		<span class="keyword">if</span> (cachedAdvisors != <span class="keyword">null</span>) &#123;</div><div class="line">			advisors.addAll(cachedAdvisors);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			MetadataAwareAspectInstanceFactory factory = <span class="keyword">this</span>.aspectFactoryCache.get(aspectName);</div><div class="line">			advisors.addAll(<span class="keyword">this</span>.advisorFactory.getAdvisors(factory));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> advisors;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于bean工厂中的所有的<code>bean</code> 判断是否有<code>Aspect</code>注解 并且不是由<code>ajc</code>编译 <code>code-style</code>编程的方式 再前面已经处理过了 这里就不再处理 对于下面部分的代码阅读来说 有些读者可能会觉得困难 看着这么多陌生的名字很长的类就觉得好难 其实这些类只是一些包装util而已 为的就是不会在一个方法里面代码过多显得臃肿 <code>AspectMetadata</code> <code>MetadataAwareAspectInstanceFactory</code>都是起到这样的作用 下面的部分就是本文的重头戏了 寻找<code>advisor</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;Advisor&gt; <span class="title">getAdvisors</span><span class="params">(MetadataAwareAspectInstanceFactory maaif)</span> </span>&#123;</div><div class="line">	<span class="keyword">final</span> Class&lt;?&gt; aspectClass = maaif.getAspectMetadata().getAspectClass();</div><div class="line">	<span class="keyword">final</span> String aspectName = maaif.getAspectMetadata().getAspectName();</div><div class="line">	validate(aspectClass);</div><div class="line"></div><div class="line">	<span class="comment">// We need to wrap the MetadataAwareAspectInstanceFactory with a decorator</span></div><div class="line">	<span class="comment">// so that it will only instantiate once.</span></div><div class="line">	<span class="keyword">final</span> MetadataAwareAspectInstanceFactory lazySingletonAspectInstanceFactory =</div><div class="line">			<span class="keyword">new</span> LazySingletonAspectInstanceFactoryDecorator(maaif);</div><div class="line"></div><div class="line">	<span class="keyword">final</span> List&lt;Advisor&gt; advisors = <span class="keyword">new</span> LinkedList&lt;Advisor&gt;();</div><div class="line">	<span class="comment">// 循环所有的切面方法</span></div><div class="line">	<span class="keyword">for</span> (Method method : getAdvisorMethods(aspectClass)) &#123;</div><div class="line">		<span class="comment">//  将切面方法转化为advisor</span></div><div class="line">		Advisor advisor = getAdvisor(method, lazySingletonAspectInstanceFactory, advisors.size(), aspectName);</div><div class="line">		<span class="keyword">if</span> (advisor != <span class="keyword">null</span>) &#123;</div><div class="line">			advisors.add(advisor);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// If it's a per target aspect, emit the dummy instantiating aspect.</span></div><div class="line">	<span class="keyword">if</span> (!advisors.isEmpty() &amp;&amp; lazySingletonAspectInstanceFactory.getAspectMetadata().isLazilyInstantiated()) &#123;</div><div class="line">		Advisor instantiationAdvisor = <span class="keyword">new</span> SyntheticInstantiationAdvisor(lazySingletonAspectInstanceFactory);</div><div class="line">		advisors.add(<span class="number">0</span>, instantiationAdvisor);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Find introduction fields.</span></div><div class="line">	<span class="keyword">for</span> (Field field : aspectClass.getDeclaredFields()) &#123;</div><div class="line">		Advisor advisor = getDeclareParentsAdvisor(field);</div><div class="line">		<span class="keyword">if</span> (advisor != <span class="keyword">null</span>) &#123;</div><div class="line">			advisors.add(advisor);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> advisors;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们这里先列举一个切面的例子 这样可能更有助于读者阅读 这个例子可以从<a href="">github-springmvcdemo</a>中<code>clone</code>下来<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogTipAspect</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Around</span>(<span class="string">"@annotation(com.sunmingshuai.annotation.LogTip)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundEntry</span><span class="params">(ProceedingJoinPoint pjp)</span></span>&#123;</div><div class="line">		System.out.print(<span class="string">"before aroundEntry"</span>);</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			pjp.proceed();</div><div class="line">		&#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</div><div class="line">			throwable.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		System.out.print(<span class="string">"before aroundEntry"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Before</span>(<span class="string">"@annotation(com.sunmingshuai.annotation.LogTip)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeEntry</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.print(<span class="string">"beforeEntry"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@After</span>(<span class="string">"@annotation(com.sunmingshuai.annotation.LogTip)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterEntry</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.print(<span class="string">"afterEntry"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@AfterThrowing</span>(<span class="string">"@annotation(com.sunmingshuai.annotation.LogTip)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.print(<span class="string">"afterEntry"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@AfterReturning</span>(<span class="string">"@annotation(com.sunmingshuai.annotation.LogTip)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.print(<span class="string">"afterReturning"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>getAdvisorMethods(aspectClass)</code>方法就是找出切面类中的所有的切面方法 看下这里的实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> List&lt;Method&gt; <span class="title">getAdvisorMethods</span><span class="params">(Class&lt;?&gt; aspectClass)</span> </span>&#123;</div><div class="line">	<span class="keyword">final</span> List&lt;Method&gt; methods = <span class="keyword">new</span> LinkedList&lt;Method&gt;();</div><div class="line">	<span class="comment">// 筛选出没有Pointcut注解的方法 其实就是为了想获取所有的@Before @After @Around等注解标注的方法</span></div><div class="line">	<span class="comment">// 这里的实现是直接排除Pointcut注解 这样代码更简洁些吧</span></div><div class="line">	ReflectionUtils.doWithMethods(aspectClass, <span class="keyword">new</span> ReflectionUtils.MethodCallback() &#123;</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doWith</span><span class="params">(Method method)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">			<span class="comment">// Exclude pointcuts</span></div><div class="line">			<span class="keyword">if</span> (AnnotationUtils.getAnnotation(method, Pointcut.class) == <span class="keyword">null</span>) &#123;</div><div class="line">				methods.add(method);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 多个comparator的排序: 多个comparator组成一个排序链 程序执行这个排序链 有一个comparator返回非0数字则返回 或者直到执行完排序链 返回0</div><div class="line">	 * 有点类似与sql中多个列的排序算法</div><div class="line">	 * 最后排序结果 Around.class, Before.class, After.class, AfterReturning.class, AfterThrowing.class</div><div class="line">	 */</div><div class="line">	Collections.sort(methods, METHOD_COMPARATOR);</div><div class="line">	<span class="keyword">return</span> methods;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码里面的注释已经很清晰了 找出被切面所注释的方法 注意在方法返回前对方法进行了排序 这个排序算法阅读起来不太容易 主要是因为有多重排序 读者可以学习一下这个方法 也许在工作中能用的到 最后的排序顺序是<br><code>Around.class, Before.class, After.class, AfterReturning.class, AfterThrowing.class</code> 这个顺序是很重要的 影响到后面方法调用过程中执行链的顺序<br>然后再把找到的方法转化成<code>advisor</code>保存 我们可以想象的出来 这样一个<code>advisor</code>保存了非常多的信息在里面<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Advisor <span class="title">getAdvisor</span><span class="params">(Method candidateAdviceMethod, MetadataAwareAspectInstanceFactory aif,</span></span></div><div class="line">		<span class="keyword">int</span> declarationOrderInAspect, String aspectName) &#123;</div><div class="line"></div><div class="line">	validate(aif.getAspectMetadata().getAspectClass());</div><div class="line"></div><div class="line">	<span class="comment">// 包装类: 拆解出切面的切点表达式</span></div><div class="line">		AspectJExpressionPointcut ajexp =</div><div class="line">			getPointcut(candidateAdviceMethod, aif.getAspectMetadata().getAspectClass());</div><div class="line">	<span class="keyword">if</span> (ajexp == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//从构造函数中可以看出Advisor的组成结构 pointcut advice</span></div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> InstantiationModelAwarePointcutAdvisorImpl(</div><div class="line">			<span class="keyword">this</span>, ajexp, aif, candidateAdviceMethod, declarationOrderInAspect, aspectName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对于切面来说 肯定要指定切点的 也就是这个方法在什么地点执行? <code>getPointcut</code>方法就比较简单了 首先查看是否有切面方法注解 然后根据切点构造<code>AspectJExpressionPointcut</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> AspectJExpressionPointcut <span class="title">getPointcut</span><span class="params">(Method candidateAdviceMethod, Class&lt;?&gt; candidateAspectClass)</span> </span>&#123;</div><div class="line">	AspectJAnnotation&lt;?&gt; aspectJAnnotation =</div><div class="line">			AbstractAspectJAdvisorFactory.findAspectJAnnotationOnMethod(candidateAdviceMethod);</div><div class="line">	<span class="keyword">if</span> (aspectJAnnotation == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">	AspectJExpressionPointcut ajexp =</div><div class="line">			<span class="keyword">new</span> AspectJExpressionPointcut(candidateAspectClass, <span class="keyword">new</span> String[<span class="number">0</span>], <span class="keyword">new</span> Class[<span class="number">0</span>]);</div><div class="line">	ajexp.setExpression(aspectJAnnotation.getPointcutExpression());</div><div class="line">	<span class="keyword">return</span> ajexp;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后再看最后一步构造<code>advisor</code> 可以看到是直接调用构造函数构造了一个实现类<code>InstantiationModelAwarePointcutAdvisorImpl</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">InstantiationModelAwarePointcutAdvisorImpl</span><span class="params">(AspectJAdvisorFactory af, AspectJExpressionPointcut ajexp,</span></span></div><div class="line">		MetadataAwareAspectInstanceFactory aif, Method method, <span class="keyword">int</span> declarationOrderInAspect, String aspectName) &#123;</div><div class="line"></div><div class="line">	<span class="keyword">this</span>.declaredPointcut = ajexp;</div><div class="line">	<span class="keyword">this</span>.method = method;</div><div class="line">	<span class="keyword">this</span>.atAspectJAdvisorFactory = af;</div><div class="line">	<span class="keyword">this</span>.aspectInstanceFactory = aif;</div><div class="line">	<span class="keyword">this</span>.declarationOrder = declarationOrderInAspect;</div><div class="line">	<span class="keyword">this</span>.aspectName = aspectName;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (aif.getAspectMetadata().isLazilyInstantiated()) &#123;</div><div class="line">		<span class="comment">// Static part of the pointcut is a lazy type.</span></div><div class="line">		Pointcut preInstantiationPointcut =</div><div class="line">				Pointcuts.union(aif.getAspectMetadata().getPerClausePointcut(), <span class="keyword">this</span>.declaredPointcut);</div><div class="line"></div><div class="line">		<span class="comment">// Make it dynamic: must mutate from pre-instantiation to post-instantiation state.</span></div><div class="line">		<span class="comment">// If it's not a dynamic pointcut, it may be optimized out</span></div><div class="line">		<span class="comment">// by the Spring AOP infrastructure after the first evaluation.</span></div><div class="line">		<span class="keyword">this</span>.pointcut = <span class="keyword">new</span> PerTargetInstantiationModelPointcut(<span class="keyword">this</span>.declaredPointcut, preInstantiationPointcut, aif);</div><div class="line">		<span class="keyword">this</span>.lazy = <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		<span class="comment">// A singleton aspect.</span></div><div class="line">		<span class="keyword">this</span>.instantiatedAdvice = instantiateAdvice(<span class="keyword">this</span>.declaredPointcut);</div><div class="line">		<span class="keyword">this</span>.pointcut = declaredPointcut;</div><div class="line">		<span class="keyword">this</span>.lazy = <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>方法的内部就是各种赋值操作  但有一个方法需要看一下 <code>instantiateAdvice(this.declaredPointcut)</code> 我们往下追踪<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Advice <span class="title">getAdvice</span><span class="params">(Method candidateAdviceMethod, AspectJExpressionPointcut ajexp,</span></span></div><div class="line">		MetadataAwareAspectInstanceFactory aif, <span class="keyword">int</span> declarationOrderInAspect, String aspectName) &#123;</div><div class="line"></div><div class="line">	Class&lt;?&gt; candidateAspectClass = aif.getAspectMetadata().getAspectClass();</div><div class="line">	validate(candidateAspectClass);</div><div class="line"></div><div class="line">	AspectJAnnotation&lt;?&gt; aspectJAnnotation =</div><div class="line">			AbstractAspectJAdvisorFactory.findAspectJAnnotationOnMethod(candidateAdviceMethod);</div><div class="line">	<span class="keyword">if</span> (aspectJAnnotation == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// If we get here, we know we have an AspectJ method.</span></div><div class="line">	<span class="comment">// Check that it's an AspectJ-annotated class</span></div><div class="line">	<span class="keyword">if</span> (!isAspect(candidateAspectClass)) &#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">"Advice must be declared inside an aspect type: "</span> +</div><div class="line">				<span class="string">"Offending method '"</span> + candidateAdviceMethod + <span class="string">"' in class ["</span> +</div><div class="line">				candidateAspectClass.getName() + <span class="string">"]"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">		logger.debug(<span class="string">"Found AspectJ method: "</span> + candidateAdviceMethod);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	AbstractAspectJAdvice springAdvice;</div><div class="line"></div><div class="line">	<span class="keyword">switch</span> (aspectJAnnotation.getAnnotationType()) &#123;</div><div class="line">		<span class="keyword">case</span> AtBefore:</div><div class="line">			springAdvice = <span class="keyword">new</span> AspectJMethodBeforeAdvice(candidateAdviceMethod, ajexp, aif);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> AtAfter:</div><div class="line">			springAdvice = <span class="keyword">new</span> AspectJAfterAdvice(candidateAdviceMethod, ajexp, aif);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> AtAfterReturning:</div><div class="line">			springAdvice = <span class="keyword">new</span> AspectJAfterReturningAdvice(candidateAdviceMethod, ajexp, aif);</div><div class="line">			AfterReturning afterReturningAnnotation = (AfterReturning) aspectJAnnotation.getAnnotation();</div><div class="line">			<span class="keyword">if</span> (StringUtils.hasText(afterReturningAnnotation.returning())) &#123;</div><div class="line">				springAdvice.setReturningName(afterReturningAnnotation.returning());</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> AtAfterThrowing:</div><div class="line">			springAdvice = <span class="keyword">new</span> AspectJAfterThrowingAdvice(candidateAdviceMethod, ajexp, aif);</div><div class="line">			AfterThrowing afterThrowingAnnotation = (AfterThrowing) aspectJAnnotation.getAnnotation();</div><div class="line">			<span class="keyword">if</span> (StringUtils.hasText(afterThrowingAnnotation.throwing())) &#123;</div><div class="line">				springAdvice.setThrowingName(afterThrowingAnnotation.throwing());</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> AtAround:</div><div class="line">			springAdvice = <span class="keyword">new</span> AspectJAroundAdvice(candidateAdviceMethod, ajexp, aif);</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> AtPointcut:</div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"Processing pointcut '"</span> + candidateAdviceMethod.getName() + <span class="string">"'"</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</div><div class="line">					<span class="string">"Unsupported advice type on method "</span> + candidateAdviceMethod);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Now to configure the advice...</span></div><div class="line">	springAdvice.setAspectName(aspectName);</div><div class="line">	springAdvice.setDeclarationOrder(declarationOrderInAspect);</div><div class="line">	<span class="comment">// argNames</span></div><div class="line">	String[] argNames = <span class="keyword">this</span>.parameterNameDiscoverer.getParameterNames(candidateAdviceMethod);</div><div class="line">	<span class="keyword">if</span> (argNames != <span class="keyword">null</span>) &#123;</div><div class="line">		springAdvice.setArgumentNamesFromStringArray(argNames);</div><div class="line">	&#125;</div><div class="line">	springAdvice.calculateArgumentBindings();</div><div class="line">	<span class="keyword">return</span> springAdvice;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到生成了对应的<code>advice</code> 下面又对方法的参数进行处理<br>argNames指的是注解的<code>argNames</code>参数提供的值 这里会考虑<code>JoinPoint</code> <code>ProceedingJoinPoint</code>特殊参数 这些参数是框架默认支持提供的 一般约定放到参数的第一位<br>带了读者绕了这么久 读者可能已经不知道我们是从哪里进来的 进来的目的又是什么了 让我们再回到最开始的代码 我们进行了这么多步的操作其实就是为了要验证是不是应该要跳过这个<code>bean</code> 如果这个<code>bean</code>本身就是切面类的话 那么就不会被代理了<br>继续往下执行 如果没有<code>beanclass</code>所对应的<code>targetsource</code>的话 也一样不会代理的 <code>targetsource</code>相关的知识不再介绍 创建代理的地方其实是在<code>postProcessAfterInitialization</code>中<br>预知后事如何 且听下回分析…</p>
</div><div class="tags"><a href="/tags/aop/">aop</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2017/05/22/aop源码解析一-注册BPP/" class="pre">aop源码解析一:注册BPP</a><a href="/2017/06/01/aop源码解析三-postProcessAfterInitialization/" class="next">aop源码解析三:postProcessAfterInitialization</a></div><div id="comments"><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java并发包/">Java并发包</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Raspberry-Pi/">Raspberry Pi</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring源码分析/">Spring源码分析</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat源码分析/">Tomcat源码分析</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/书单/">书单</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/">杂七杂八</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/concurrent/" style="font-size: 15px;">concurrent</a> <a href="/tags/context/" style="font-size: 15px;">context</a> <a href="/tags/aop/" style="font-size: 15px;">aop</a> <a href="/tags/BFPP/" style="font-size: 15px;">BFPP</a> <a href="/tags/jdk动态代理/" style="font-size: 15px;">jdk动态代理</a> <a href="/tags/component-scan/" style="font-size: 15px;">component-scan</a> <a href="/tags/父子容器/" style="font-size: 15px;">父子容器</a> <a href="/tags/兴趣爱好/" style="font-size: 15px;">兴趣爱好</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/31/Spring问题快问快答/">Spring问题快问快答</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/07/AbstractQueuedSynchronizer-队列同步器-实现分析/">AbstractQueuedSynchronizer(队列同步器)实现分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/aop源码解析辅助-jdk动态代理/">aop源码解析辅助:jdk动态代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/aop源码解析四-代理方法的调用/">aop源码解析四:代理方法的调用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/20/树莓派安装Ubuntu-server/">树莓派安装Ubuntu server</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/15/为什么要读书/">为什么要读书</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/spring父子容器源码解析二/">spring父子容器源码解析二</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/spring父子容器源码解析一/">spring父子容器源码解析一</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/aop源码解析三-postProcessAfterInitialization/">aop源码解析三:postProcessAfterInitialization</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/aop源码解析二-postProcessBeforeInstantiation/">aop源码解析二:postProcessBeforeInstantiation</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">孙明帅.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.0"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.0" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>var cloudTieConfig = {
  url: document.location.href, 
  sourceId: "",
  productKey: '7e92867159a646e798100b8a60c85579## 网易云跟帖(productKey)',
  target: "cloud-tie-wrapper"
};</script><script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script></body></html>